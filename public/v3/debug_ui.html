<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talking Forest - UI Test Lab üß™</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2d6a4f',
                        earth: '#603813',
                        gold: '#ffd700',
                        parchment: '#fdf6e3'
                    },
                    fontFamily: {
                        'bakso': ['"Bakso Sapi"', 'cursive'],
                        'nunito': ['"Nunito"', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <!-- Alpine.js (Defer) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- System UI -->
    <link rel="stylesheet" href="../css/system-ui.css">
    <link rel="stylesheet" href="../css/game.css">
    <script src="../js/v3/components/system-ui.js"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bakso+Sapi&family=Nunito:wght@400;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
</head>

<body class="bg-gray-900 h-screen w-screen flex flex-col items-center justify-center font-nunito p-4">

    <!-- Mobile Frame -->
    <div class="w-full max-w-[480px] h-full bg-parchment relative shadow-2xl overflow-y-auto flex flex-col"
        x-data="{ activeTab: 'toast' }">

        <!-- Header -->
        <header class="bg-forest text-white p-4 shadow-md sticky top-0 z-10">
            <h1 class="font-bakso text-2xl text-center">üß™ UI Test Lab</h1>
            <p class="text-xs text-center text-green-200">Debug System UI Components</p>
        </header>

        <!-- Tabs -->
        <div class="flex border-b border-gray-200 bg-white sticky top-[76px] z-10">
            <button @click="activeTab = 'toast'" class="flex-1 py-3 text-sm font-bold border-b-2 transition"
                :class="activeTab === 'toast' ? 'border-forest text-forest bg-green-50' : 'border-transparent text-gray-400'">
                üçû TOAST
            </button>
            <button @click="activeTab = 'modal'" class="flex-1 py-3 text-sm font-bold border-b-2 transition"
                :class="activeTab === 'modal' ? 'border-forest text-forest bg-green-50' : 'border-transparent text-gray-400'">
                üéâ MODAL
            </button>
            <button @click="activeTab = 'overlay'" class="flex-1 py-3 text-sm font-bold border-b-2 transition"
                :class="activeTab === 'overlay' ? 'border-forest text-forest bg-green-50' : 'border-transparent text-gray-400'">
                üõ°Ô∏è OVERLAY
            </button>
        </div>

        <!-- Content -->
        <div class="p-4 space-y-4 pb-20">

            <!-- 1. TOAST TESTS -->
            <div x-show="activeTab === 'toast'" class="space-y-3">
                <button @click="$store.systemUI.showToast('Sukses! Data tersimpan.', 'success')"
                    class="w-full bg-green-100 text-green-700 py-3 rounded-xl font-bold border border-green-200 hover:bg-green-200 transition text-left px-4 flex items-center gap-3">
                    <span>‚úÖ</span> Toast Success
                </button>
                <button @click="$store.systemUI.showToast('Gagal! Coba lagi nanti.', 'error')"
                    class="w-full bg-red-100 text-red-700 py-3 rounded-xl font-bold border border-red-200 hover:bg-red-200 transition text-left px-4 flex items-center gap-3">
                    <span>‚ùå</span> Toast Error
                </button>
                <button @click="$store.systemUI.showToast('+1500 XP', 'xp')"
                    class="w-full bg-purple-100 text-purple-700 py-3 rounded-xl font-bold border border-purple-200 hover:bg-purple-200 transition text-left px-4 flex items-center gap-3">
                    <span>‚ú®</span> Toast XP
                </button>
                <button @click="$store.systemUI.showToast('Info: Jangan lupa siram!', 'info')"
                    class="w-full bg-blue-100 text-blue-700 py-3 rounded-xl font-bold border border-blue-200 hover:bg-blue-200 transition text-left px-4 flex items-center gap-3">
                    <span>‚ÑπÔ∏è</span> Toast Info
                </button>
            </div>


            <!-- 2. MODAL TESTS -->
            <div x-show="activeTab === 'modal'" class="space-y-3">
                <button
                    @click="$store.systemUI.showModal('LEVEL_UP', {level: 5, rank: 'Ranger Senior', stars: 3, bonus: {xp: 500, unlock: 'Bibit Mangga'}})"
                    class="w-full bg-gradient-to-r from-yellow-100 to-orange-100 text-orange-800 py-3 rounded-xl font-bold border border-orange-200 hover:brightness-95 transition text-left px-4">
                    üéâ Level Up
                </button>
                <button
                    @click="$store.systemUI.showModal('ACHIEVEMENT_UNLOCK', {badge: {icon: 'üî•', name: 'Api Semangat', description: 'Login 7 hari berturut-turut!'}, xp: 100})"
                    class="w-full bg-gray-100 text-gray-800 py-3 rounded-xl font-bold border border-gray-200 hover:bg-gray-200 transition text-left px-4">
                    üîì Unlock Badge
                </button>
                <button
                    @click="$store.systemUI.showModal('BADGE_DETAIL', {icon: 'üå≥', name: 'Pahlawan Bumi', description: 'Menanam 1000 pohon seumur hidup.', date: '12 Feb 2026'})"
                    class="w-full bg-white text-gray-800 py-3 rounded-xl font-bold border border-gray-200 hover:bg-gray-50 transition text-left px-4 shadow-sm">
                    üèÖ Badge Detail
                </button>
                <button
                    @click="$store.systemUI.showModal('CONFIRM_EXIT', {message: 'Mau keluar? Progres belum disimpan lho!', onConfirm: () => alert('Confirmed!')})"
                    class="w-full bg-red-50 text-red-600 py-3 rounded-xl font-bold border border-red-100 hover:bg-red-100 transition text-left px-4">
                    ‚ö†Ô∏è Confirm Exit
                </button>
                <button
                    @click="$store.systemUI.showModal('EDIT_NICKNAME', {currentName: 'Ranger Naju', onSave: (name) => $store.systemUI.showToast('Nama baru: ' + name, 'success')})"
                    class="w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold border border-blue-100 hover:bg-blue-100 transition text-left px-4">
                    ‚úèÔ∏è Edit Nickname
                </button>
            </div>

            <!-- 3. OVERLAY TESTS -->
            <div x-show="activeTab === 'overlay'" class="space-y-3">
                <button
                    @click="$store.systemUI.setLoading(true, 'Sedang mengetes...'); setTimeout(() => $store.systemUI.setLoading(false), 3000)"
                    class="w-full bg-gray-800 text-white py-3 rounded-xl font-bold hover:bg-gray-700 transition text-left px-4">
                    ‚è≥ Loading (3 Detik)
                </button>
                <button
                    @click="$store.systemUI.showError('OFFLINE', 'Koneksi internet terputus. Coba periksa wifi kamu.')"
                    class="w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition text-left px-4">
                    üì° Error Offline
                </button>
                <button @click="$store.systemUI.showError('GENERAL', 'Terjadi kesalahan sistem yang tidak diketahui.')"
                    class="w-full bg-red-800 text-white py-3 rounded-xl font-bold hover:bg-red-900 transition text-left px-4">
                    üòµ Error General
                </button>
            </div>

        </div>

        <!-- ======================================================================
         SYSTEM UI CONTAINERS (COPY-PASTE FROM INDEX/DONATE)
         ====================================================================== -->

        <!-- Toast Container -->
        <div class="toast-container" x-data>
            <template x-for="toast in $store.systemUI.toasts" :key="toast.id">
                <div class="toast" :class="{
                     'toast-success': toast.type === 'success',
                     'toast-error': toast.type === 'error',
                     'toast-xp': toast.type === 'xp',
                     'toast-info': toast.type === 'info',
                     'show': toast.visible
                 }" x-show="toast.visible" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-2"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100 translate-y-0"
                    x-transition:leave-end="opacity-0 translate-y-2">

                    <div class="toast-icon">
                        <span x-show="toast.type === 'success'">‚úÖ</span>
                        <span x-show="toast.type === 'error'">‚ùå</span>
                        <span x-show="toast.type === 'xp'">‚ú®</span>
                        <span x-show="toast.type === 'info'">‚ÑπÔ∏è</span>
                    </div>
                    <div class="toast-message" x-text="toast.message"></div>
                </div>
            </template>
        </div>

        <!-- Modal Overlay -->
        <template x-if="$store.systemUI.modal.isOpen" x-data>
            <div class="modal-overlay"
                :class="{'modal-level-up': $store.systemUI.modal.type === 'LEVEL_UP', 'modal-achievement': $store.systemUI.modal.type === 'ACHIEVEMENT_UNLOCK'}">

                <!-- Level Up Modal -->
                <template x-if="$store.systemUI.modal.type === 'LEVEL_UP'">
                    <div class="modal-content">
                        <div class="level-badge" x-text="$store.systemUI.modal.data.level || '?'"></div>
                        <h2 class="modal-title">üéâ SELAMAT! üéâ</h2>
                        <p class="modal-subtitle"
                            style="text-align:center; font-weight:bold; color:#4CAF50; margin-bottom:10px;">NAIK LEVEL!
                        </p>
                        <p class="modal-body">Kamu sekarang di Level <span
                                x-text="$store.systemUI.modal.data.level"></span>!</p>

                        <!-- Rank & Stars -->
                        <template x-if="$store.systemUI.modal.data.rank">
                            <div class="level-rank"
                                style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <p style="margin-bottom: 4px;">Rank: <strong
                                        x-text="$store.systemUI.modal.data.rank"></strong></p>
                                <div class="star-rating" style="color: #FFD700; letter-spacing: 2px;"
                                    x-html="'‚òÖ'.repeat($store.systemUI.modal.data.stars || 0) + '‚òÜ'.repeat(5 - ($store.systemUI.modal.data.stars || 0))">
                                </div>
                            </div>
                        </template>

                        <!-- Bonus -->
                        <template x-if="$store.systemUI.modal.data.bonus">
                            <div class="level-bonus" style="margin-top: 10px; font-size: 0.9em;">
                                <p>üéÅ BONUS:</p>
                                <p style="color: #F59E0B; font-weight:bold;"
                                    x-text="'+' + ($store.systemUI.modal.data.bonus.xp || 0) + ' XP'"></p>
                                <template x-if="$store.systemUI.modal.data.bonus.unlock">
                                    <p style="color: #4CAF50;">üîì <span
                                            x-text="$store.systemUI.modal.data.bonus.unlock"></span></p>
                                </template>
                            </div>
                        </template>

                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">LANJUT ‚ñ∂</button>
                        </div>
                    </div>
                </template>

                <!-- Achievement Unlock Modal (ALUR 12.4) -->
                <template x-if="$store.systemUI.modal.type === 'ACHIEVEMENT_UNLOCK'">
                    <div class="modal-content">
                        <div class="modal-icon badge-bounce">üîì</div>
                        <h2 class="modal-title">LENCANA BARU!</h2>
                        <div class="badge-icon-large" x-text="$store.systemUI.modal.data.badge?.icon || 'üèÜ'"></div>
                        <h3 class="badge-name" x-text="$store.systemUI.modal.data.badge?.name || 'Badge'"></h3>
                        <p class="modal-body" x-text="$store.systemUI.modal.data.badge?.description || ''"></p>
                        <p class="xp-reward" x-text="'+' + ($store.systemUI.modal.data.xp || 50) + ' XP üéâ'"></p>
                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">KEREN! ‚úì</button>
                        </div>
                    </div>
                </template>

                <!-- Badge Detail Modal -->
                <template x-if="$store.systemUI.modal.type === 'BADGE_DETAIL'">
                    <div class="modal-content">
                        <div class="modal-icon" x-text="$store.systemUI.modal.data.icon || 'üèÜ'"></div>
                        <h2 class="modal-title" x-text="$store.systemUI.modal.data.name || 'Badge'"></h2>
                        <p class="modal-body" x-text="$store.systemUI.modal.data.description || ''"></p>
                        <template x-if="$store.systemUI.modal.data.date">
                            <p class="badge-date" style="font-size: 0.8em; color: #6B7280; margin-top: 5px;">
                                üìÖ Didapat: <span x-text="$store.systemUI.modal.data.date"></span></p>
                        </template>
                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">Tutup</button>
                        </div>
                    </div>
                </template>

                <!-- Confirm Exit Modal -->
                <template x-if="$store.systemUI.modal.type === 'CONFIRM_EXIT'">
                    <div class="modal-content">
                        <div class="modal-icon">‚ö†Ô∏è</div>
                        <h2 class="modal-title">TUNGGU DULU!</h2>
                        <p class="modal-body"
                            x-text="$store.systemUI.modal.data.message || 'Kamu yakin mau keluar? Progress belum tersimpan!'">
                        </p>
                        <div class="modal-actions">
                            <button class="modal-btn secondary"
                                @click="$store.systemUI.modal.data.onConfirm?.(); $store.systemUI.closeModal()">KELUAR</button>
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">LANJUT ‚ñ∂</button>
                        </div>
                    </div>
                </template>

                <!-- Edit Nickname Modal (ALUR 12.1) -->
                <template x-if="$store.systemUI.modal.type === 'EDIT_NICKNAME'" x-data="{ 
                    newName: $store.systemUI.modal.data.currentName || '',
                    limit: 15
                }">
                    <div class="modal-content relative pt-10 px-6 pb-6 text-left">
                        <!-- Close Button -->
                        <button @click="$store.systemUI.closeModal()"
                            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition">
                            <span class="material-icons-round">close</span>
                        </button>

                        <!-- Title -->
                        <div class="text-center mb-6">
                            <h2 class="text-xl font-bold text-forest flex items-center justify-center gap-2">
                                <span>‚úèÔ∏è</span> EDIT NICKNAME
                            </h2>
                            <div class="h-1 w-32 bg-forest/20 mx-auto mt-2 rounded-full"></div>
                        </div>

                        <!-- Current Name -->
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Nama saat ini:</label>
                            <div class="text-lg font-bakso text-gray-800 bg-gray-50 px-3 py-2 rounded-lg border border-gray-200"
                                x-text="'&quot;' + ($store.systemUI.modal.data.currentName || '-') + '&quot;'"></div>
                        </div>

                        <!-- New Name Input -->
                        <div class="mb-2">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Nama baru:</label>
                            <input type="text" x-model="newName" :maxlength="limit" placeholder="Ketik nama baru..."
                                class="w-full px-4 py-3 rounded-xl bg-white border-2 border-forest/30 text-gray-800 font-bold focus:outline-none focus:border-forest transition placeholder-gray-400 shadow-inner">
                        </div>

                        <!-- Validasi / Counter -->
                        <div class="flex justify-between text-xs font-bold text-gray-400 mb-4 px-1">
                            <span x-show="newName.length === 0" class="text-red-400">*Wajib diisi</span>
                            <span x-show="newName.length > 0"></span>
                            <span x-text="newName.length + '/' + limit + ' karakter'"></span>
                        </div>

                        <!-- Warning -->
                        <div class="flex items-center gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-200 mb-6">
                            <span class="text-yellow-600">‚ö†Ô∏è</span>
                            <span class="text-xs text-yellow-700 font-bold">
                                Sisa ganti: <span x-text="$store.systemUI.modal.data.remainingEdits || 2">2</span>x
                            </span>
                        </div>

                        <!-- Actions -->
                        <div class="grid grid-cols-2 gap-3">
                            <button
                                class="modal-btn secondary !text-gray-500 hover:!bg-gray-100 flex items-center justify-center"
                                @click="$store.systemUI.closeModal()">
                                BATAL
                            </button>
                            <button
                                class="modal-btn primary flex items-center justify-center shadow-lg shadow-green-500/30"
                                @click="if(newName.trim().length > 0) { $store.systemUI.modal.data.onSave?.(newName); $store.systemUI.closeModal(); } else { alert('Nama tidak boleh kosong!'); }"
                                :disabled="newName.trim().length === 0"
                                :class="newName.trim().length === 0 ? 'opacity-50 cursor-not-allowed filter grayscale' : ''">
                                SIMPAN
                            </button>
                        </div>
                    </div>
                </template>

            </div>
        </template>

        <!-- Loading Overlay -->
        <template x-if="$store.systemUI.loading.isActive" x-data>
            <div class="loading-overlay">
                <div class="loading-spinner"></div>
                <p class="loading-text" x-text="$store.systemUI.loading.message"></p>
            </div>
        </template>

        <!-- Error Overlay -->
        <template x-if="$store.systemUI.error.isActive" x-data>
            <div class="error-overlay" :class="$store.systemUI.error.code === 'OFFLINE' ? 'error-offline' : ''">
                <div class="error-icon" x-text="$store.systemUI.error.code === 'OFFLINE' ? 'üì°' : 'üòµ'"></div>
                <h2 class="error-title"
                    x-text="$store.systemUI.error.code === 'OFFLINE' ? 'Tidak Ada Koneksi' : 'Terjadi Kesalahan'"></h2>
                <p class="error-message" x-text="$store.systemUI.error.message"></p>

                <div class="error-actions" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="error-btn" @click="$store.systemUI.hideError(); location.reload()">Coba Lagi
                        üîÑ</button>

                    <template x-if="$store.systemUI.error.code === 'OFFLINE'">
                        <button class="error-btn secondary"
                            style="background: transparent; border: 1px solid rgba(255,255,255,0.3);"
                            @click="$store.systemUI.hideError()">MODE OFFLINE üì¥</button>
                    </template>

                    <template x-if="$store.systemUI.error.code !== 'OFFLINE'">
                        <button class="error-btn secondary"
                            style="background: transparent; border: 1px solid rgba(255,255,255,0.3);"
                            @click="window.location.href='index.html'">KEMBALI KE HOME</button>
                    </template>
                </div>
            </div>
        </template>

    </div>
</body>

</html>