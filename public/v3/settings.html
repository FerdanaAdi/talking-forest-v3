<!DOCTYPE html>
<html lang="id">
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                              ‚ïë
‚ïë   üìÑ NAMA FILE: v3/settings.html                                            ‚ïë
‚ïë   ‚öôÔ∏è FUNGSI: Halaman Pengaturan (ALUR 16)                                   ‚ïë
‚ïë   üìç POSISI: Menu pengaturan sound, bahasa, dan data                        ‚ïë
‚ïë                                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üî∞ PANDUAN UNTUK NAJU:
- File ini mengatur tampilan dan logika halaman Pengaturan
- User bisa mengubah volume, bahasa, mode gelap, dan reset data

YANG BOLEH DIEDIT:
‚úÖ Teks label (Suara, Bahasa, dll)
‚úÖ Warna dan ikon

YANG JANGAN DIEDIT:
‚úó Nama variabel Alpine (sfxVolume, language, dll)
‚úó Logika saveSetting()
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengaturan - Talking Forest</title>

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        forest: '#2d6a4f',
                        earth: '#603813',
                        gold: '#ffd700',
                        parchment: '#fdf6e3'
                    },
                    fontFamily: {
                        'bakso': ['"Bakso Sapi"', 'cursive'],
                        'nunito': ['"Nunito"', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/game.css">
    <link rel="stylesheet" href="../css/system-ui.css">
    <script src="../js/v3/components/system-ui.js"></script>
</head>

<body class="bg-stone-900 h-screen w-screen flex items-center justify-center overflow-hidden font-nunito">

    <!-- Phone Frame -->
    <div class="relative w-full max-w-[480px] h-full max-h-[900px] bg-gradient-to-b from-[#0a1628] via-[#0f1f38] to-[#0a1628] overflow-hidden flex flex-col"
        x-data="settingsLogic">

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             HEADER
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <header class="flex-shrink-0 flex items-center gap-3 px-5 py-4 border-b border-white/10 relative z-50">
            <button
                @click="if(window.history.length > 1) { window.history.back(); } else { window.location.href = 'profile.html'; }"
                class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white hover:bg-white/20 transition shadow-lg">
                <span class="text-xl font-bold">‚Üê</span>
            </button>
            <h1 class="text-xl font-bold text-white">‚öôÔ∏è Pengaturan</h1>
        </header>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             SETTINGS CONTENT
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <main class="flex-1 overflow-y-auto px-5 py-6 space-y-6">

            <!-- üîä SUARA -->
            <section class="bg-white/5 rounded-2xl p-5 border border-white/10">
                <h2 class="text-white/80 font-semibold mb-4 flex items-center gap-2">
                    üîä Suara
                </h2>

                <div class="space-y-4">
                    <!-- SFX Volume -->
                    <div class="flex items-center justify-between">
                        <span class="text-white/70 text-sm">Efek Suara</span>
                        <div class="flex items-center gap-3">
                            <input type="range" min="0" max="1" step="0.1" x-model="sfxVolume"
                                @input="saveSetting('sfxVolume', sfxVolume)" class="w-24 accent-green-500">
                            <span class="text-white/50 text-xs w-8" x-text="Math.round(sfxVolume * 100) + '%'"></span>
                        </div>
                    </div>

                    <!-- BGM Volume -->
                    <div class="flex items-center justify-between">
                        <span class="text-white/70 text-sm">Musik Latar</span>
                        <div class="flex items-center gap-3">
                            <input type="range" min="0" max="1" step="0.1" x-model="bgmVolume"
                                @input="saveSetting('bgmVolume', bgmVolume)" class="w-24 accent-green-500">
                            <span class="text-white/50 text-xs w-8" x-text="Math.round(bgmVolume * 100) + '%'"></span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- üåê BAHASA -->
            <section class="bg-white/5 rounded-2xl p-5 border border-white/10">
                <h2 class="text-white/80 font-semibold mb-4 flex items-center gap-2">
                    üåê Bahasa
                </h2>

                <div class="space-y-2">
                    <label class="flex items-center justify-between p-3 rounded-xl cursor-pointer transition"
                        :class="language === 'id' ? 'bg-green-500/20 border border-green-500/50' : 'bg-white/5 hover:bg-white/10'">
                        <span class="text-white/80">üáÆüá© Indonesia</span>
                        <input type="radio" name="language" value="id" x-model="language"
                            @change="saveSetting('language', language)" class="accent-green-500">
                    </label>

                    <label class="flex items-center justify-between p-3 rounded-xl cursor-pointer transition"
                        :class="language === 'en' ? 'bg-green-500/20 border border-green-500/50' : 'bg-white/5 hover:bg-white/10'">
                        <span class="text-white/80">üá¨üáß English</span>
                        <input type="radio" name="language" value="en" x-model="language"
                            @change="saveSetting('language', language)" class="accent-green-500">
                    </label>
                </div>
            </section>

            <!-- üì± TAMPILAN -->
            <section class="bg-white/5 rounded-2xl p-5 border border-white/10">
                <h2 class="text-white/80 font-semibold mb-4 flex items-center gap-2">
                    üì± Tampilan
                </h2>

                <div class="space-y-4">
                    <!-- Dark Mode -->
                    <div class="flex items-center justify-between">
                        <span class="text-white/70 text-sm">Mode Gelap</span>
                        <button @click="toggleDarkMode()" class="w-12 h-6 rounded-full transition-colors relative"
                            :class="darkMode ? 'bg-green-500' : 'bg-white/20'">
                            <span class="w-5 h-5 bg-white rounded-full absolute top-0.5 transition-all"
                                :class="darkMode ? 'left-6' : 'left-0.5'"></span>
                        </button>
                    </div>

                    <!-- Animations -->
                    <div class="flex items-center justify-between">
                        <span class="text-white/70 text-sm">Animasi</span>
                        <button @click="toggleAnimations()" class="w-12 h-6 rounded-full transition-colors relative"
                            :class="animationsEnabled ? 'bg-green-500' : 'bg-white/20'">
                            <span class="w-5 h-5 bg-white rounded-full absolute top-0.5 transition-all"
                                :class="animationsEnabled ? 'left-6' : 'left-0.5'"></span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- üìä DATA -->
            <section class="bg-white/5 rounded-2xl p-5 border border-white/10">
                <h2 class="text-white/80 font-semibold mb-4 flex items-center gap-2">
                    üìä Data
                </h2>

                <div class="space-y-3">
                    <button @click="clearCache()"
                        class="w-full flex items-center justify-between p-3 rounded-xl bg-white/5 hover:bg-white/10 transition text-left">
                        <span class="text-white/70 text-sm">Hapus Cache</span>
                        <span class="text-white/40">‚Üí</span>
                    </button>

                    <button @click="exportData()"
                        class="w-full flex items-center justify-between p-3 rounded-xl bg-white/5 hover:bg-white/10 transition text-left">
                        <span class="text-white/70 text-sm">Export Data</span>
                        <span class="text-white/40">‚Üí</span>
                    </button>

                    <button @click="confirmReset()"
                        class="w-full flex items-center justify-between p-3 rounded-xl bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 transition text-left">
                        <span class="text-red-400 text-sm">Reset Progress</span>
                        <span class="text-red-400/50">‚ö†Ô∏è</span>
                    </button>
                </div>
            </section>

            <!-- ‚ÑπÔ∏è TENTANG -->
            <section class="bg-white/5 rounded-2xl p-5 border border-white/10">
                <h2 class="text-white/80 font-semibold mb-4 flex items-center gap-2">
                    ‚ÑπÔ∏è Tentang
                </h2>

                <div class="space-y-2 text-sm text-white/50">
                    <p>Versi: <span class="text-white/70">3.0.0</span></p>
                    <p>Developer: <span class="text-white/70">Tim Wong Papat ora Beres Kebeh</span></p>
                    <p class="pt-2 text-xs">¬© 2026 Talking Forest. Hak cipta dilindungi.</p>
                </div>
            </section>

        </main>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
             BOTTOM NAVIGATION
             ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <nav
            class="flex-shrink-0 flex justify-around items-center py-3 px-5 bg-gradient-to-t from-black/50 to-transparent border-t border-white/10">
            <a href="../index.html"
                class="flex flex-col items-center gap-1 text-white/40 hover:text-white/70 transition">
                <span class="text-xl">üè†</span>
                <span class="text-xs">Markas</span>
            </a>
            <a href="scan.html" class="flex flex-col items-center gap-1 text-white/40 hover:text-white/70 transition">
                <span class="text-xl">üì∏</span>
                <span class="text-xs">Jelajah</span>
            </a>
            <a href="garden.html" class="flex flex-col items-center gap-1 text-white/40 hover:text-white/70 transition">
                <span class="text-xl">üåø</span>
                <span class="text-xs">Kebun</span>
            </a>
            <a href="donate.html" class="flex flex-col items-center gap-1 text-white/40 hover:text-white/70 transition">
                <span class="text-xl">üíö</span>
                <span class="text-xs">Donasi</span>
            </a>
            <a href="profile.html"
                class="flex flex-col items-center gap-1 text-white/40 hover:text-white/70 transition">
                <span class="text-xl">üë§</span>
                <span class="text-xs">Profil</span>
            </a>
        </nav>

        <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SYSTEM UI TEMPLATES (ALUR 12-15)
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

        <!-- Toast Container -->
        <div class="toast-container">
            <template x-for="toast in $store.systemUI.toasts" :key="toast.id">
                <div class="toast" :class="{
                         'toast-success': toast.type === 'success',
                         'toast-error': toast.type === 'error',
                         'toast-xp': toast.type === 'xp',
                         'toast-info': toast.type === 'info',
                         'show': toast.visible
                     }" x-show="toast.visible" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-2"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-in duration-300"
                    x-transition:leave-start="opacity-100 translate-y-0"
                    x-transition:leave-end="opacity-0 translate-y-2">

                    <div class="toast-icon">
                        <span x-show="toast.type === 'success'">‚úÖ</span>
                        <span x-show="toast.type === 'error'">‚ùå</span>
                        <span x-show="toast.type === 'xp'">‚ú®</span>
                        <span x-show="toast.type === 'info'">‚ÑπÔ∏è</span>
                    </div>
                    <div class="toast-message" x-text="toast.message"></div>
                </div>
            </template>
        </div>

        <!-- Modal Overlay -->
        <template x-if="$store.systemUI.modal.isOpen" x-data>
            <div class="modal-overlay"
                :class="{'modal-level-up': $store.systemUI.modal.type === 'LEVEL_UP', 'modal-achievement': $store.systemUI.modal.type === 'ACHIEVEMENT_UNLOCK'}">

                <!-- Level Up Modal -->
                <template x-if="$store.systemUI.modal.type === 'LEVEL_UP'">
                    <div class="modal-content">
                        <div class="level-badge" x-text="$store.systemUI.modal.data.level || '?'"></div>
                        <h2 class="modal-title">üéâ SELAMAT! üéâ</h2>
                        <p class="modal-subtitle"
                            style="text-align:center; font-weight:bold; color:#4CAF50; margin-bottom:10px;">NAIK LEVEL!
                        </p>
                        <p class="modal-body">Kamu sekarang di Level <span
                                x-text="$store.systemUI.modal.data.level"></span>!</p>

                        <!-- Rank & Stars -->
                        <template x-if="$store.systemUI.modal.data.rank">
                            <div class="level-rank"
                                style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <p style="margin-bottom: 4px;">Rank: <strong
                                        x-text="$store.systemUI.modal.data.rank"></strong></p>
                                <div class="star-rating" style="color: #FFD700; letter-spacing: 2px;"
                                    x-html="'‚òÖ'.repeat($store.systemUI.modal.data.stars || 0) + '‚òÜ'.repeat(5 - ($store.systemUI.modal.data.stars || 0))">
                                </div>
                            </div>
                        </template>

                        <!-- Bonus -->
                        <template x-if="$store.systemUI.modal.data.bonus">
                            <div class="level-bonus" style="margin-top: 10px; font-size: 0.9em;">
                                <p>üéÅ BONUS:</p>
                                <p style="color: #F59E0B; font-weight:bold;"
                                    x-text="'+' + ($store.systemUI.modal.data.bonus.xp || 0) + ' XP'"></p>
                                <template x-if="$store.systemUI.modal.data.bonus.unlock">
                                    <p style="color: #4CAF50;">üîì <span
                                            x-text="$store.systemUI.modal.data.bonus.unlock"></span></p>
                                </template>
                            </div>
                        </template>

                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">LANJUT ‚ñ∂</button>
                        </div>
                    </div>
                </template>

                <!-- Achievement Unlock Modal (ALUR 12.4) -->
                <template x-if="$store.systemUI.modal.type === 'ACHIEVEMENT_UNLOCK'">
                    <div class="modal-content">
                        <div class="modal-icon badge-bounce">üîì</div>
                        <h2 class="modal-title">LENCANA BARU!</h2>
                        <div class="badge-icon-large" x-text="$store.systemUI.modal.data.badge?.icon || 'üèÜ'"></div>
                        <h3 class="badge-name" x-text="$store.systemUI.modal.data.badge?.name || 'Badge'"></h3>
                        <p class="modal-body" x-text="$store.systemUI.modal.data.badge?.description || ''"></p>
                        <p class="xp-reward" x-text="'+' + ($store.systemUI.modal.data.xp || 50) + ' XP üéâ'"></p>
                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">KEREN! ‚úì</button>
                        </div>
                    </div>
                </template>

                <!-- Badge Detail Modal -->
                <template x-if="$store.systemUI.modal.type === 'BADGE_DETAIL'">
                    <div class="modal-content">
                        <div class="modal-icon" x-text="$store.systemUI.modal.data.icon || 'üèÜ'"></div>
                        <h2 class="modal-title" x-text="$store.systemUI.modal.data.name || 'Badge'"></h2>
                        <p class="modal-body" x-text="$store.systemUI.modal.data.description || ''"></p>
                        <template x-if="$store.systemUI.modal.data.date">
                            <p class="badge-date" style="font-size: 0.8em; color: #6B7280; margin-top: 5px;">üìÖ Didapat:
                                <span x-text="$store.systemUI.modal.data.date"></span>
                            </p>
                        </template>
                        <div class="modal-actions">
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">Tutup</button>
                        </div>
                    </div>
                </template>

                <!-- Confirm Exit Modal -->
                <template x-if="$store.systemUI.modal.type === 'CONFIRM_EXIT'">
                    <div class="modal-content">
                        <div class="modal-icon">‚ö†Ô∏è</div>
                        <h2 class="modal-title">TUNGGU DULU!</h2>
                        <p class="modal-body"
                            x-text="$store.systemUI.modal.data.message || 'Kamu yakin mau keluar? Progress belum tersimpan!'">
                        </p>
                        <div class="modal-actions">
                            <button class="modal-btn secondary"
                                @click="$store.systemUI.modal.data.onConfirm?.(); $store.systemUI.closeModal()">KELUAR</button>
                            <button class="modal-btn primary" @click="$store.systemUI.closeModal()">LANJUT ‚ñ∂</button>
                        </div>
                    </div>
                </template>

                <!-- Edit Nickname Modal (ALUR 12.1) -->
                <template x-if="$store.systemUI.modal.type === 'EDIT_NICKNAME'" x-data="{ 
                    newName: $store.systemUI.modal.data.currentName || '',
                    limit: 15
                }">
                    <div class="modal-content relative pt-10 px-6 pb-6 text-left">
                        <!-- Close Button -->
                        <button @click="$store.systemUI.closeModal()"
                            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition">
                            <span class="material-icons-round">close</span>
                        </button>

                        <!-- Title -->
                        <div class="text-center mb-6">
                            <h2 class="text-xl font-bold text-forest flex items-center justify-center gap-2">
                                <span>‚úèÔ∏è</span> EDIT NICKNAME
                            </h2>
                            <div class="h-1 w-32 bg-forest/20 mx-auto mt-2 rounded-full"></div>
                        </div>

                        <!-- Current Name -->
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Nama saat ini:</label>
                            <div class="text-lg font-bakso text-gray-800 bg-gray-50 px-3 py-2 rounded-lg border border-gray-200"
                                x-text="'&quot;' + ($store.systemUI.modal.data.currentName || '-') + '&quot;'"></div>
                        </div>

                        <!-- New Name Input -->
                        <div class="mb-2">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Nama baru:</label>
                            <input type="text" x-model="newName" :maxlength="limit" placeholder="Ketik nama baru..."
                                class="w-full px-4 py-3 rounded-xl bg-white border-2 border-forest/30 text-gray-800 font-bold focus:outline-none focus:border-forest transition placeholder-gray-400 shadow-inner">
                        </div>

                        <!-- Validasi / Counter -->
                        <div class="flex justify-between text-xs font-bold text-gray-400 mb-4 px-1">
                            <span x-show="newName.length === 0" class="text-red-400">*Wajib diisi</span>
                            <span x-show="newName.length > 0"></span>
                            <span x-text="newName.length + '/' + limit + ' karakter'"></span>
                        </div>

                        <!-- Warning -->
                        <div class="flex items-center gap-2 bg-yellow-50 p-3 rounded-lg border border-yellow-200 mb-6">
                            <span class="text-yellow-600">‚ö†Ô∏è</span>
                            <span class="text-xs text-yellow-700 font-bold">
                                Sisa ganti: <span x-text="$store.systemUI.modal.data.remainingEdits || 2">2</span>x
                            </span>
                        </div>

                        <!-- Actions -->
                        <div class="grid grid-cols-2 gap-3">
                            <button
                                class="modal-btn secondary !text-gray-500 hover:!bg-gray-100 flex items-center justify-center"
                                @click="$store.systemUI.closeModal()">
                                BATAL
                            </button>
                            <button
                                class="modal-btn primary flex items-center justify-center shadow-lg shadow-green-500/30"
                                @click="if(newName.trim().length > 0) { $store.systemUI.modal.data.onSave?.(newName); $store.systemUI.closeModal(); } else { alert('Nama tidak boleh kosong!'); }"
                                :disabled="newName.trim().length === 0"
                                :class="newName.trim().length === 0 ? 'opacity-50 cursor-not-allowed filter grayscale' : ''">
                                SIMPAN
                            </button>
                        </div>
                    </div>
                </template>

            </div>
        </template>

        <!-- Loading Overlay -->
        <template x-if="$store.systemUI.loading.isActive" x-data>
            <div class="loading-overlay">
                <div class="loading-spinner"></div>
                <p class="loading-text" x-text="$store.systemUI.loading.message"></p>
            </div>
        </template>

        <!-- Error Overlay -->
        <template x-if="$store.systemUI.error.isActive" x-data>
            <div class="error-overlay" :class="$store.systemUI.error.code === 'OFFLINE' ? 'error-offline' : ''">
                <div class="error-icon" x-text="$store.systemUI.error.code === 'OFFLINE' ? 'üì°' : 'üòµ'"></div>
                <h2 class="error-title"
                    x-text="$store.systemUI.error.code === 'OFFLINE' ? 'Tidak Ada Koneksi' : 'Terjadi Kesalahan'"></h2>
                <p class="error-message" x-text="$store.systemUI.error.message"></p>

                <div class="error-actions" style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="error-btn" @click="$store.systemUI.hideError(); location.reload()">Coba Lagi
                        üîÑ</button>

                    <template x-if="$store.systemUI.error.code === 'OFFLINE'">
                        <button class="error-btn secondary"
                            style="background: transparent; border: 1px solid rgba(255,255,255,0.3);"
                            @click="$store.systemUI.hideError()">MODE OFFLINE üì¥</button>
                    </template>

                    <template x-if="$store.systemUI.error.code !== 'OFFLINE'">
                        <button class="error-btn secondary"
                            style="background: transparent; border: 1px solid rgba(255,255,255,0.3);"
                            @click="window.location.href='index.html'">KEMBALI KE HOME</button>
                    </template>
                </div>
            </div>
        </template>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ALPINE.JS LOGIC
         ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('settingsLogic', () => ({
                // Load settings from localStorage
                sfxVolume: parseFloat(localStorage.getItem('tfv3_sfx_volume') || '0.5'),
                bgmVolume: parseFloat(localStorage.getItem('tfv3_bgm_volume') || '0.3'),
                language: localStorage.getItem('tfv3_language') || 'id',
                darkMode: localStorage.getItem('tfv3_dark_mode') === 'true',
                animationsEnabled: localStorage.getItem('tfv3_animations') !== 'false',

                // Navigation
                goBack() {
                    window.history.back();
                },

                // Save settings
                saveSetting(key, value) {
                    const storageKey = 'tfv3_' + key.replace(/([A-Z])/g, '_$1').toLowerCase();
                    localStorage.setItem(storageKey, value);

                    // Show toast notification
                    if (window.Alpine && Alpine.store('systemUI')) {
                        Alpine.store('systemUI').showToast('Pengaturan disimpan', 'success');
                    }
                },

                // Toggle functions
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                    this.saveSetting('darkMode', this.darkMode);
                },

                toggleAnimations() {
                    this.animationsEnabled = !this.animationsEnabled;
                    this.saveSetting('animationsEnabled', this.animationsEnabled);
                },

                // Data management
                clearCache() {
                    if (confirm('Hapus cache aplikasi? Ini tidak akan menghapus progress kamu.')) {
                        // Clear only cache-related items
                        const keysToKeep = ['tfv3_player', 'tfv3_garden', 'tfv3_inventory'];
                        Object.keys(localStorage).forEach(key => {
                            if (key.startsWith('tfv3_cache_')) {
                                localStorage.removeItem(key);
                            }
                        });
                        alert('Cache berhasil dihapus!');
                    }
                },

                exportData() {
                    const data = {};
                    Object.keys(localStorage).forEach(key => {
                        if (key.startsWith('tfv3_')) {
                            data[key] = localStorage.getItem(key);
                        }
                    });

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'talking-forest-backup.json';
                    a.click();
                    URL.revokeObjectURL(url);
                },

                confirmReset() {
                    if (confirm('‚ö†Ô∏è PERINGATAN!\n\nIni akan menghapus SEMUA progress game kamu:\n- XP dan Level\n- Koleksi pohon\n- Badge dan prestasi\n\nApakah kamu yakin?')) {
                        if (confirm('Kamu akan kehilangan semua data. Ketik OK untuk melanjutkan.')) {
                            Object.keys(localStorage).forEach(key => {
                                if (key.startsWith('tfv3_')) {
                                    localStorage.removeItem(key);
                                }
                            });
                            alert('Progress berhasil direset. Halaman akan dimuat ulang.');
                            window.location.href = '../index.html';
                        }
                    }
                }
            }));
        });
    </script>

</body>

</html>